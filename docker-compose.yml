web:
  build: ./web
  expose:
    - "8000"
  links:
    - mongo
  volumes:
    - /opt/web/app/static/img
  environment:
    - ZAS_CONFIG=/etc/zas/zas.cfg
    - ZAS_GOOGLE_SECRET=/etc/zas/google_secret.json
  command: --access-logfile "/var/log/web/gunicorn_access.log" --error-logfile "/var/log/web/gunicorn_error.log"
  restart: always

mongo-express:
  image: mongo-express
  links:
    - mongo
  expose:
    - "8081"

nginx:
  image: nginx
  ports:
    - "80:80"
  links:
    - web
    - mongo-express
  volumes_from:
    - web:ro
  restart: always

backup:
  build: ./backup
  volumes_from:
    - dbdata:ro
  restart: always

mongo:
  image: mongo
  expose:
    - "27017"
  volumes_from:
    - dbdata
  command: -f /etc/mongod/mongod.yml
  restart: always

dbdata:
  image: ubuntu
  volumes:
    - /data/db
  command: /usr/bin/tail -f /dev/null
  restart: always
